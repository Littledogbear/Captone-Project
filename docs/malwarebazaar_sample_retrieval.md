# MalwareBazaar Sample Retrieval Guide

This guide provides detailed instructions for retrieving malware samples from MalwareBazaar and using them with the Cyber Attack Tracer project in a VMware Fusion environment.

## 1. MalwareBazaar API Overview

MalwareBazaar is a repository of malware samples that can be accessed programmatically through its API. The API endpoint is:
```
https://mb-api.abuse.ch/api/v1/
```

**Note:** The API cannot be accessed directly through a browser. All requests must be made programmatically with proper parameters and authentication headers.

**Environment Note:** Linux environment is recommended as some dependencies are not Windows-compatible. The sample retrieval and analysis functionality works best on Linux-based systems.

## 2. Setting Up API Access

### 2.1 API Key Configuration
```bash
# Set your MalwareBazaar API key as an environment variable
export Malware_Bazzar_personal_key="your_api_key_here"

# Verify the key is set correctly
echo $Malware_Bazzar_personal_key
```

### 2.2 Required Python Packages
```bash
# Ensure these packages are installed
pip install requests python-magic
```

## 3. Retrieving Malware Samples

### 3.1 Using the Built-in Sample Retrieval Script
The project includes a script for downloading samples from MalwareBazaar:

```bash
# Run the MalwareBazaar sample downloader (Linux environment recommended)
python test_malware_samples.py
```

This script will:
1. Connect to MalwareBazaar API using your API key
2. Download sample malware files to the `samples` directory
3. Store metadata about the samples for analysis

### 3.2 Sample Query Parameters

The script supports various query parameters:

- `query_type`: Type of query (default: `get_recent`)
- `limit`: Maximum number of samples to retrieve (default: `3`)
- `tags`: Specific malware tags to filter by (e.g., `ransomware`, `trojan`)

You can modify these parameters in the script to retrieve different types of samples.

## 4. Working with Downloaded Samples

### 4.1 Sample Storage Location
Downloaded samples are stored in:
```
samples/malwarebazaar/
```

Each sample is stored with its SHA256 hash as the filename.

### 4.2 Sample Metadata
Metadata for each sample is stored in:
```
samples/malwarebazaar/metadata/
```

This includes information such as:
- File type
- Tags
- Signature information
- First/last seen dates
- Intelligence reports

## 5. Simulating Malware Detection

### 5.1 Running the Attribution Test
```bash
# Run the attribution test with downloaded samples
python run_attribution_test_with_sample_data.py
```

This will:
1. Process the downloaded malware samples
2. Generate attribution data
3. Create knowledge graphs
4. Produce security reports

### 5.2 Running the Dashboard with Samples
```bash
# Run the dashboard with malware samples
python run_dashboard_with_malware.py
```

This will:
1. Start the monitoring dashboard
2. Load the downloaded samples
3. Generate alerts for the detected malware
4. Display the alerts in the dashboard

## 6. Safety Considerations

### 6.1 Isolation Requirements
When working with malware samples:
- Ensure your virtual machine is isolated from your main network
- Use a dedicated VM for malware analysis
- Disable shared folders between host and VM
- Disable clipboard sharing between host and VM

### 6.2 Sample Handling
- Never execute malware samples directly
- Use the built-in analysis tools to examine samples safely
- Keep your VM software updated with security patches
- Consider taking a VM snapshot before working with samples

### 6.3 Network Configuration
- Configure the VM to use a NAT network or host-only network
- Consider using a VPN for additional isolation
- Monitor network traffic to ensure samples don't communicate externally

## 7. Troubleshooting

### 7.1 API Request Failures
If API requests fail:
- Verify your API key is correctly set
- Check your internet connection
- Ensure the API endpoint is accessible from your VM
- Verify you're not exceeding API rate limits

### 7.2 Sample Download Issues
If sample downloads fail:
- Check disk space availability
- Verify write permissions to the samples directory
- Ensure the sample is available in MalwareBazaar
- Check if your API key has download permissions

### 7.3 Sample Analysis Failures
If sample analysis fails:
- Check if the sample format is supported
- Verify all dependencies are installed
- Check log files for specific error messages
- Ensure the sample is not corrupted
